<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quart MongoDB CRUD</title>
</head>
<body>
    {% for collection_name, documents in all_docs.items() %}
        <h1>{{ collection_name }}</h1>
        <ul>
            {% for document in documents %}
                <li>
                    {% for key, value in document.items() %}
                        {{ key }}: {{ value }}<br>
                    {% endfor %}
                    <a href="{{ url_for('delete', document_id=document._id) }}">Delete</a>
                </li>
            {% endfor %}
        </ul>
        <form action="{{ url_for('add') }}" method="post">
            <label for="document_data">New Document:</label>
            <input type="text" id="document_data" name="document_data" required>
            <button type="submit">Add Document</button>
        </form>
        <form action="{{ url_for('delete_collection', collection_name=collection_name) }}" method="post" onsubmit="return deleteCollectionAndRefresh(this)">
            <button type="submit">Delete Collection</button>
        </form>
    {% endfor %}

   <script>
    async function deleteCollectionAndRefresh(form) {
        const response = await fetch(form.action, {
            method: form.method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({}),
        });

        const result = await response.json();

        // Check if the server indicates to refresh the page
        if (result.redirect_url) {
            // Redirect to the specified URL
            window.location.href = result.redirect_url;
        }

        return false;  // Prevent the form from submitting conventionally
    }
    </script>
</body>
</html>
